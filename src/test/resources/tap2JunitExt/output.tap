running (cwd: ./test/start/env): node --unhandled-rejections=strict test.test.js
TAP version 13
# from-env service name test
ok 1 should be strictly equal

1..1
# tests 1
# pass  1

# ok

running (cwd: ./test/start/file): node --unhandled-rejections=strict test.test.js
TAP version 13
# from-file serviceName test
ok 1 should be strictly equal

1..1
# tests 1
# pass  1

# ok

running (cwd: ./): node --unhandled-rejections=strict test/uncaught-exceptions/log-uncaught-exceptions-off.test.js
TAP version 13
# should capture uncaught exceptions but not log if disabled
ok 1 should capture the error
{"log.level":"info","@timestamp":"2021-11-17T19:25:34.315Z","log":{"logger":"elastic-apm-node"},"ecs":{"version":"1.6.0"},"message":"Sending error to Elastic APM: {\"id\":\"9446a5c532f320fcbce5c3fa73d943ec\"}"}
ok 2 error.exception.message
ok 3 error.exception.type
ok 4 error.exception.handled
ok 5 should have a stack trace
ok 6 stack trace should contain frames
ok 7 top frame should be this file

1..7
# tests 7
# pass  7

# ok

running (cwd: ./): node --unhandled-rejections=strict test/uncaught-exceptions/log-uncaught-exceptions-on.test.js
TAP version 13
# should capture and log uncaught exceptions by default
ok 1 should log the error to STDERR
ok 2 should capture the error
{"log.level":"info","@timestamp":"2021-11-17T19:25:35.118Z","log":{"logger":"elastic-apm-node"},"ecs":{"version":"1.6.0"},"message":"Sending error to Elastic APM: {\"id\":\"7ba652580b0501c5089ae16d0a0aeb11\"}"}
ok 3 should be strictly equal
ok 4 should be strictly equal
ok 5 should be strictly equal
ok 6 should have a stack trace
ok 7 stack trace should contain frames
ok 8 top frame should be this file

1..8
# tests 8
# pass  8

# ok

---------------------------------------|---------|----------|---------|---------|-------------------
File                                   | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
---------------------------------------|---------|----------|---------|---------|-------------------
All files                              |   39.66 |    23.58 |   36.27 |   40.37 |
 apm-agent-nodejs                      |     100 |      100 |     100 |     100 |
  index.js                             |     100 |      100 |     100 |     100 |
 apm-agent-nodejs/lib                  |   48.44 |    33.25 |      50 |   48.68 |
  InflightEventSet.js                  |   35.71 |       25 |      50 |   35.71 | 16-19,27-33
  agent.js                             |   54.12 |    32.35 |    42.5 |   55.14 | ...35-649,654-665
  config.js                            |   63.71 |    49.33 |   76.19 |   64.97 | ...31-834,940,948
  constants.js                         |     100 |      100 |     100 |     100 |
  errors.js                            |   54.86 |    30.98 |    87.5 |   55.14 | ...16-228,233-251
  http-request.js                      |    42.1 |    53.33 |   45.45 |    42.1 | ...32,188-223,227
  lambda.js                            |       4 |        0 |    6.66 |       4 | ...29-390,396-446
  logging.js                           |   58.33 |    35.71 |      60 |   58.33 | ...13,119-137,165
  noop-transport.js                    |   18.18 |       10 |   11.11 |   18.18 | 17-30,36-42
  parsers.js                           |   12.96 |        0 |       0 |    13.2 | 16-113
  stacktraces.js                       |   57.22 |    49.07 |    82.6 |    56.8 | ...73,413,422,425
  symbols.js                           |     100 |      100 |     100 |     100 |
  wildcard-matcher.js                  |   80.95 |       75 |   66.66 |      80 | 16-17,44-45
 apm-agent-nodejs/lib/cloud-metadata   |      50 |    39.43 |   48.14 |      50 |
  aws.js                               |   27.45 |       25 |   18.75 |   27.45 | ...07,119,140-156
  azure.js                             |   36.84 |       50 |    37.5 |   36.84 | 36-51,57,78-109
  callback-coordination.js             |   75.55 |    47.82 |   85.71 |   75.55 | ...,92-93,130-131
  gcp.js                               |   27.08 |    16.66 |      25 |   27.08 | ...7,53,57,74-140
  index.js                             |   79.62 |    45.83 |      80 |   79.62 | 116,147-156,162
 apm-agent-nodejs/lib/filters          |   26.92 |    17.14 |    12.5 |      28 |
  http-headers.js                      |   33.33 |       30 |      20 |   35.71 | 28-65
  sanitize-field-names.js              |   18.18 |        0 |       0 |   18.18 | 15-51
 apm-agent-nodejs/lib/instrumentation  |   26.69 |     8.97 |   15.89 |    27.6 |
  context.js                           |   15.78 |        0 |       0 |   15.78 | 7-10,14-26,38-55
  express-utils.js                     |   14.28 |        0 |       0 |      16 | 9-55
  generic-span.js                      |   25.71 |        0 |       0 |   26.86 | ...29-131,135,139
  http-shared.js                       |   23.57 |    14.94 |   31.57 |   25.19 | ...57-170,176-287
  ids.js                               |   18.18 |      100 |       0 |   18.18 | 7-25
  index.js                             |   39.04 |    21.69 |   31.42 |   39.18 | ...94-497,502-505
  named-array.js                       |   47.61 |       10 |    62.5 |      50 | 28-47
  shimmer.js                           |   35.29 |    32.35 |   33.33 |      36 | ...1,69-71,81-109
  span.js                              |   20.68 |        0 |       0 |   21.23 | ...82-186,190-247
  timer.js                             |    6.66 |        0 |       0 |    7.14 | 6-7,13-62
  transaction.js                       |   18.07 |        0 |       0 |   19.04 | ...95-302,307-376
 ...nodejs/lib/instrumentation/modules |   44.11 |    29.62 |      40 |   48.38 |
  http.js                              |   44.11 |    29.62 |      40 |   48.38 | 7,31-58
 ...js/lib/instrumentation/run-context |   33.33 |    19.64 |    37.5 |   33.56 |
  AbstractRunContextManager.js         |   16.17 |     3.57 |   19.04 |   15.15 | 29-51,70,95-189
  AsyncHooksRunContextManager.js       |    62.5 |       50 |      75 |    62.5 | 30-45,60,65,85
  BasicRunContextManager.js            |   59.09 |      100 |   45.45 |    61.9 | 24-39,62-63
  RunContext.js                        |   20.68 |       25 |    37.5 |   21.42 | 44,53-101
  index.js                             |     100 |      100 |     100 |     100 |
 apm-agent-nodejs/lib/metrics          |   58.55 |    37.14 |   45.45 |   59.58 |
  index.js                             |   40.74 |    26.66 |   23.07 |   40.74 | 40-76
  queue.js                             |    3.44 |        0 |       0 |    3.57 | 4-78
  registry.js                          |     100 |       60 |     100 |     100 | 10-15,19-34
  reporter.js                          |    65.3 |       36 |   85.71 |   69.56 | ...71,77-81,93-98
  runtime.js                           |    93.1 |       70 |   66.66 |   92.59 | 7,11
 ...dejs/lib/metrics/platforms/generic |     100 |       75 |     100 |     100 |
  index.js                             |     100 |      100 |     100 |     100 |
  process-cpu.js                       |     100 |      100 |     100 |     100 |
  process-top.js                       |     100 |      100 |     100 |     100 |
  stats.js                             |     100 |       50 |     100 |     100 | 24
  system-cpu.js                        |     100 |      100 |     100 |     100 |
 apm-agent-nodejs/lib/middleware       |      20 |      100 |       0 |      20 |
  connect.js                           |      20 |      100 |       0 |      20 | 4-7
 apm-agent-nodejs/lib/redact-secrets   |      45 |        0 |      10 |   56.25 |
  index.js                             |      40 |        0 |      20 |      50 | 35-42
  is-secret.js                         |      50 |        0 |       0 |    62.5 | 51-56
 apm-agent-nodejs/lib/tracecontext     |    2.45 |        0 |       0 |    2.63 |
  index.js                             |   17.39 |        0 |       0 |   18.18 | 7-64
  tracestate.js                        |    0.55 |        0 |       0 |    0.59 | 5-349
---------------------------------------|---------|----------|---------|---------|-------------------
