pull_request_rules:
  - name: ask to resolve conflict
    conditions:
      - conflict
    actions:
        comment:
          message: |
            This pull request is now in conflicts. Could you fix it @{{author}}? 🙏
            To fixup this pull request, you can check out it locally. See documentation: https://help.github.com/articles/checking-out-pull-requests-locally/
            ```
            git fetch upstream
            git checkout -b {{head}} upstream/{{head}}
            git merge upstream/{{base}}
            git push upstream {{head}}
            ```
  - name: Automatic squash and merge on approval with success checks and ready-to-merge label
    conditions:
      - "#approved-reviews-by>=2"
      - check-success=apm-ci/pr-merge
      - check-success=CLA
      - check-success=Test
      - label=ready-to-merge
      - base=master
    actions:
      merge:
        method: squash
        strict: smart+fasttrack
        priority: high
  - name: backport patches to 7.x branch
    conditions:
      - base=master
      - label=backport-to-7.x
    actions:
      backport:
        branches:
          - 7.x
  - name: Automatic squash and merge on approval with success checks and ready-to-merge label for 7.x
    conditions:
      - check-success=apm-ci/pr-merge
      - check-success=CLA
      - check-success=Test
      - base=7.x
    actions:
      merge:
        method: squash
        strict: smart+fasttrack
        priority: low
