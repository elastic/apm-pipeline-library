pull_request_rules:
  - name: Automatic squash and merge on approval with success checks and ready-to-merge label
    conditions:
      - "#approved-reviews-by>=2"
      - check-success=apm-ci/pr-merge
      - check-success=CLA
      - check-success=Test
      - label=ready-to-merge
      - base=master
    actions:
      merge:
        method: squash
        strict: smart+fasttrack
  - name: backport patches to 7.x branch
    conditions:
      - base=master
      - label=backport-to-7.x
    actions:
      backport:
        branches:
          - 7.x
        title: "[{{ destination_branch }}](backport #{{ number }}) {{ title }}"
        labels:
          - "automation"
  - name: Automatic squash and merge on approval with success checks and ready-to-merge label for 7.x
    conditions:
      - check-success=apm-ci/pr-merge
      - check-success=CLA
      - check-success=Test
      - base=7.x
    actions:
      merge:
        method: squash
        strict: smart+fasttrack
  - name: delete upstream branch after merging changes
    conditions:
      - merged
      - label=automation
      - base~=^update-.*-version
    actions:
      delete_head_branch:
  - name: notify the backport policy
    conditions:
      - label~=^backport
    actions:
      comment:
        message: |
          This pull request does not have a backport label. Could you fix it @{{author}}? üôè
          To fixup this pull request, you need to add the backport labels for the needed
          branches, such as:
          * `backport-to-7.x` is the label to automatically backport to the `7.x` branch.
          NOTE: `backport-skip` has been added to this pull request.
          ```
      label:
        add:
          - backport-skip
